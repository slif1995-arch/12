# План доработки Sushi POS Android

## Этап 1: Базовая структура (✅ Завершено)
- [x] Настройка проекта и сборки
- [x] Установка зависимостей
- [x] Настройка Capacitor для Android
- [x] Решение проблем с Java 21 и Gradle
- [x] Создание базовой структуры приложения

## Этап 2: Экран выбора кассира (✅ Завершено)
- [x] Создание таблицы сотрудников в базе данных
- [x] Создание таблицы смен
- [x] Разработка экрана выбора кассира
- [x] Реализация модального окна для ввода начальной суммы
- [x] Логика открытия смены
- [x] Проверка на существующую открытую смену
- [x] Валидация начальной суммы (неотрицательная)

## Этап 3: Экран кассира
- [x] Создание таблиц категорий и подкатегорий
- [x] Разработка экрана кассира с фильтрацией по категориям
- [x] Реализация поиска товаров
- [x] Добавление товаров в корзину
- [x] Отображение товаров по категориям и подкатегориям
- [x] **Кнопка "Расходы"**
- [x] **Кнопка "История заказов"**

## Этап 4: История заказов для кассира (✅ Завершено)
### В экране кассира:
- [x] **Кнопка "История заказов"**
- [x] Отображение заказов **только за текущую смену**
- [x] Список заказов с датой, временем, суммой
- [x] **Возможность отмены заказа** (если заказ не оплачен)
- [x] **Маркировка отмененных заказов** (не удаление, а статус "Отменен")
- [x] Фильтрация заказов по статусу (оплаченные, отмененные, в работе)

## Этап 5: Модальное окно расходов (✅ Завершено)
### При нажатии на кнопку "Расходы":
- [x] **Выбор категории расходов** из списка (из админ панели)
- [x] **Выбор способа оплаты:** Наличные / Перевод
- [x] **Ввод суммы расхода**
- [x] **Поле для комментариев** (необязательно)
- [x] **Валидация суммы** (неотрицательная)
- [x] **Сохранение расхода** в текущую смену с указанием типа оплаты

## Этап 6: Улучшение корзины (✅ Завершено)
- [x] **Возможность удаления товаров из корзины**
- [x] **Добавление комментариев к товарам**
- [x] **Редактирование количества товаров**
- [x] **Модальное окно для редактирования товара в корзине**

## Этап 7: Окно оплаты (✅ Завершено)
- [x] **Выбор способа оплаты:** Наличные / Перевод
- [x] **Выбор скидки:** 10% / 50% (только фиксированные значения)
- [x] **Выбор категории заказа:** ЗАЛ / ДОСТАВКА / САМОВЫВОЗ
- [x] Отображение итоговой суммы с учетом скидки
- [x] Логика расчета сдачи для наличных
- [x] Сохранение типа заказа в базе данных

## Этап 8: Печать чеков (✅ Завершено)
### После оплаты печатать 2 чека:
- [x] **Чек для клиента** с деталями заказа, оплаты и сдачи
- [x] **Чек для кухни** с перечнем товаров без цен
- [x] Интеграция с компонентом оплаты
- [x] Автоматическая печать после завершения заказа
- [x] Отображение контактной информации на чеке клиента
- [x] Правильное форматирование даты/времени

#### **Кухонный чек:**
- Дата и время
- Кассир
- Категория: ЗАЛ / ДОСТАВКА / САМОВЫВОЗ
- **Крупно и четко:** Наименование товара
- Количество товаров
- Комментарии к товарам (если есть)

#### **Клиентский чек:**
- **Наименование заведения:** Суши Бар "Азия"
- Дата и время
- Кассир
- Наименование товара
- Количество
- **Скидка:** 10% или 50%
- Итоговая сумма
- **Пустые строки:** Адрес и телефон (для ручного ввода)

## Этап 9: Закрытие смены
### Модальное окно закрытия смены:
- [ ] **Ввод сумм по категориям:**
  - "Остаток"
  - "Терминал" 
  - "Бензин"
  - "Касса"
- [ ] **Выбор сотрудников для выплаты ЗП**
- [ ] Отображение итоговой суммы для выплаты
- [ ] Сохранение данных закрытия смены

### Отчет закрытия смены:
- [ ] **"Дата"** - дата закрытия смены
- [ ] **"Касса"** - вводится в модульном окне
- [ ] **"Выручка"** - оплата переводом + наличные
- [ ] **"Без|Нал"** - все что оплачивалось картой
- [ ] **"Терминал"** - вводится в окне
- [ ] **"Бензин"** - вводится в окне
- [ ] **"Зарплата"** - выбирается в окне
- [ ] **"Расход безнал"** - весь расход, оплаченный переводом, расписанный по категориям
- [ ] **"Расход нал"** - весь расход, оплаченный наличными, расписанный по категориям
- [ ] **"Итог"** - формула: выручка - безнал - терминал - бензин - зарплата - расход нал

## Этап 10: Расходы
### В админ панели:
- [ ] **Управление категориями расходов**
- [ ] Добавление новых типов расходов
- [ ] Редактирование и удаление категорий расходов
- [ ] Название расходов для выбора в кассе

### В экране кассира:
- [ ] **Кнопка "Расходы"**
- [ ] **Модальное окно расходов** (с выбором категории и способа оплаты)
- [ ] Добавление расхода в текущую смену
- [ ] Валидация суммы (неотрицательная)

### В отчетах:
- [ ] Учет расходов при закрытии смены
- [ ] Отображение всех расходов по категориям
- [ ] Общая сумма расходов в смене
- [ ] **Разделение расходов на "наличные" и "безналичные"** (по типу оплаты)

## Этап 11: Админ панель (локальная)
- [ ] Управление сотрудниками (кассиры, повара и др.)
- [ ] Управление принтерами (кухонный, клиентский)
- [ ] Управление товарами и категориями
- [ ] **Управление категориями расходов**
- [ ] **История смен и заказов**
- [ ] Отчеты по сменам (с учетом расходов и закрытия смены)
- [ ] Настройка системы
- [ ] Смена пароля администратора

### История смен и заказов в админ панели:
- [ ] **Список всех смен** с датами и кассирами
- [ ] **Детализация заказов по каждой смене**
- [ ] **Фильтрация заказов** по статусу (оплаченные, отмененные)
- [ ] **Маркировка отмененных заказов** (не удаление, а статус "Отменен")
- [ ] **Поиск и сортировка** по дате, сумме, кассиру

## Этап 12: Работа со сменами
- [ ] Автоматическое создание смены при выборе кассира
- [ ] Закрытие смены (с учетом расходов и выплат)
- [ ] Отслеживание активной смены
- [ ] Отображение даты/времени при открытии смены

## Этап 13: Безопасность и настройки
- [ ] Пароль для администратора (по умолчанию: 123)
- [ ] Возможность изменения пароля
- [ ] Проверка активности сотрудников
- [ ] Валидация данных

## Этап 14: Тестирование и оптимизация
- [ ] Тестирование всех функций
- [ ] Оптимизация производительности
- [ ] Обработка ошибок
- [ ] Тестирование на реальном устройстве

## Этап 15: Документация
- [ ] Создание инструкции по использованию
- [ ] Документация API
- [ ] Техническая документация

## Приоритет реализации:
1. Экран выбора кассира (самое важное)
2. Экран кассира с категориями
3. **История заказов для кассира** (новое важное требование)
4. **Модальное окно расходов**
5. Окно оплаты
6. **Печать чеков**
7. **Закрытие смены с детализированным отчетом**
8. Улучшение корзины
9. **История смен и заказов в админ панели**
10. Локальная админ панель
11. Работа со сменами

## Удаленные избыточные функции:
- ❌ История смен для каждого кассира (дублируется с админ панелью)
- ❌ Формула общей выручки (избыточно)

## Требования к базе данных:
- Таблица сотрудников: id, name, position, active
- Таблица смен: id, employee_id, start_time, end_time, initial_amount, status
- Таблица заказов: id, shift_id, order_type, payment_type, discount, total_amount, status, timestamp
- Таблица расходов: id, shift_id, expense_type, amount, payment_type, comment, timestamp
- Таблица типов расходов: id, name
- Таблица типов заказов: id, name
- Таблица товаров: id, name, price, category_id, subcategory_id
- Таблица категорий: id, name
- Таблица подкатегорий: id, name, category_id
- Таблица принтеров: id, name, type, connection_settings